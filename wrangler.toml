name = "forex-analyst-bot"
main = "worker.js"
compatibility_date = "2024-01-01"

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Compatibility flags
compatibility_flags = ["global_fetch_strictly_public", "nodejs_compat"]

[vars]
# Required environment variables (set via wrangler secret put)
# LINE_CHANNEL_SECRET - LINE Bot channel secret for signature verification
# LINE_CHANNEL_ACCESS_TOKEN - LINE Bot channel access token for sending messages
# GEMINI_API_KEY - Google Gemini API key for AI analysis
# MODEL_ID - Gemini model to use (required, e.g., gemini-2.0-flash, gemini-1.5-pro)

# Optional variables (customize as needed)
# INTERNAL_TASK_TOKEN - Shared secret for internal task validation (optional)
# FAST_ANALYSIS_DEADLINE_MS - Fast-path analysis timeout in milliseconds (optional, default: ~5000)
# AI_MAX_OUTPUT_TOKENS - Maximum output tokens for AI responses (optional, default: 1200-1600)
# INTERNAL_AI_TIMEOUT_MS - AI analysis timeout for internal tasks (optional, default: 28000 = 28s, max 30s free-tier limit)
# INTERNAL_MAX_RETRY - Max retries for internal analysis (optional, default: 1)
# EST_SECONDS_PER_IMAGE - Estimated seconds per image for queue ETA (optional, default: 30)

# For D1 database
[[d1_databases]]
binding = "DB"
database_name = "forexanalyze"
database_id = "9412eca8-24a4-4281-a518-63ecd08bcc8a"  # Fill in your D1 database ID

# For Workers KV - image cache and analysis state storage
[[kv_namespaces]]
binding = "ANALYSIS_KV"
id = "71a8015aff62487fb8ee73005d01f6b7"  # Replace with your KV namespace ID
preview_id = "71a8015aff62487fb8ee73005d01f6b7"  # Replace with your KV preview namespace ID
